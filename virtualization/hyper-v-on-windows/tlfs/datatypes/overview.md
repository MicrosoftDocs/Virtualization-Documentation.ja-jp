---
title: データの種類
description: ハイパーバイザーデータ型
keywords: hyper-v
author: alexgrest
ms.author: alegre
ms.date: 10/15/2020
ms.topic: reference
ms.prod: windows-10-hyperv
ms.openlocfilehash: 068d1c93d42422ac0c255c7201178a33040f3b47
ms.sourcegitcommit: d43632e3dc22e2b7a256b5c15fbb665c047de286
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/16/2020
ms.locfileid: "92121001"
---
# <a name="data-types"></a>データ型

## <a name="reserved-values"></a>予約値

この仕様では、一部のフィールドが "予約済み" としてドキュメントに記載されます。 これらのフィールドは、ハイパーバイザーアーキテクチャの将来のバージョンで特定の意味を持つ場合があります。 上位互換性を最大にするために、ハイパーバイザーインターフェイスのクライアントは、このドキュメントに記載されているガイダンスに従う必要があります。 一般に、2つの形式のガイダンスが用意されています。 値を保持する (図およびコードセグメント内の ReservedP で RsvdP として記載されています) –上位互換性を最大にするために、クライアントはこのフィールド内の値を保持する必要があります。 通常、これは、現在の値を読み取り、非予約フィールドの値を変更して、値を書き戻すことによって行われます。 ゼロ値 (図とコードセグメント内の ReservedZ で RsvdZ として記載されています) –上位互換性を最大にするために、クライアントはこのフィールド内の値をゼロにする必要があります。

読み取り専用構造内の予約済みフィールドは、単純に図の Rsvd として、また単にコードセグメントに予約されているものとして記述されています。 上位互換性を最大にするには、これらのフィールド内の値を無視する必要があります。 クライアントは、これらの値が常に0であると想定しないでください。

## <a name="simple-scalar-types"></a>単純なスカラー型

ハイパーバイザーデータ型は、単純なスカラー型 UINT8、UINT16、UINT32、UINT64、および UINT128 から構築されます。 これらは、指定されたビット数を持つ単純な符号なし整数スカラーを表します。 複数の対応する符号付き整数スカラーも定義されています。 INT8、INT16、INT32、INT64 です。
ハイパーバイザーでは、浮動小数点命令も浮動小数点型も使用されません。

## <a name="hypercall-status-code"></a>ハイパーコールの状態コード

すべてのハイパーコールは、HV_STATUS 型の16ビットステータスコードを返します。

 ```c
typedef UINT16 HV_STATUS;
 ```

## <a name="memory-address-space-types"></a>メモリアドレス空間の種類

ハイパーバイザーアーキテクチャでは、3つの独立したアドレス空間が定義されています。

- **システムの物理アドレス (spa)** は、cpu で認識される基礎となるハードウェアの物理アドレス空間を定義します。 コンピューター全体に対してシステム物理アドレス空間が1つだけ存在します。
- **ゲストの物理アドレス (GPAs)** は、ゲストの物理メモリのビューを定義します。 GPAs は、基になる SPAs にマップできます。 パーティションごとに1つのゲスト物理アドレス空間があります。
- ゲスト**仮想アドレス (GVAs)** は、アドレス変換を有効にし、有効なゲストページテーブルを提供するときに、ゲスト内で使用されます。

これら3つのアドレス空間のうち、最大サイズは264バイトです。 そのため、次の型が定義されます。

 ```c
typedef UINT64 HV_SPA;
typedef UINT64 HV_GPA;
typedef UINT64 HV_GVA;
 ```

多くのハイパーバイザーインターフェイスは、単一バイトではなく、メモリのページに対して機能します。 ページの最小サイズはアーキテクチャに依存します。 X64 の場合、4K として定義されます。

 ```c
#define X64_PAGE_SIZE 0x1000

#define HV_X64_MAX_PAGE_NUMBER (MAXUINT64/X64_PAGE_SIZE)
#define HV_PAGE_SIZE X64_PAGE_SIZE
#define HV_LARGE_PAGE_SIZE X64_LARGE_PAGE_SIZE
#define HV_PAGE_MASK (HV_PAGE_SIZE - 1)

typedef UINT64 HV_SPA_PAGE_NUMBER;
typedef UINT64 HV_GPA_PAGE_NUMBER;
typedef UINT64 HV_GVA_PAGE_NUMBER;
typedef UINT32 HV_SPA_PAGE_OFFSET
typedef HV_GPA_PAGE_NUMBER *PHV_GPA_PAGE_NUMBER;
 ```

をに変換するには `HV_SPA` `HV_SPA_PAGE_NUMBER` 、単にをによって除算 `HV_PAGE_SIZE` します。

## <a name="structures-enumerations-and-bit-fields"></a>構造体、列挙型、およびビットフィールド

この仕様の後半で定義されている多くのデータ構造体と定数値は、C スタイルの列挙体と構造体の観点から定義されています。 C 言語では、特定の実装の詳細を定義することを意図的に回避しています。 ただし、このドキュメントでは次のことを前提としています。

- "Enum" キーワードで宣言されたすべての列挙は、32ビットの符号付き整数値を定義します。
- すべての構造体は、フィールドが自然にアラインされるように埋め込まれます (つまり、8バイトのフィールドは8バイトのオフセットにアラインされます)。
- すべてのビットフィールドは、低順序から上位ビットにパックされ、埋め込みは行われません。

## <a name="endianness"></a>エンディアン

ハイパーバイザーインターフェイスは、エンディアン中立として設計されています (つまり、ハイパーバイザーをビッグエンディアンまたはリトルエンディアンシステムに移植できる必要があります) が、この仕様の後半で定義されている一部のデータ構造では、リトルエンディアンレイアウトが想定されます。 このようなデータ構造は、ビッグエンディアンポートが試行された場合に修正する必要があります。

## <a name="pointer-naming-convention"></a>ポインターの名前付け規則

ドキュメントでは、ポインター型の名前付け規則を使用します。 特に、定義された型の前に "P" を付加すると、その型へのポインターが示されます。 定義された型の前に "PC" を付加すると、その型の定数値へのポインターが示されます。