---
title: 機能とインターフェイスの検出
description: ハイパーバイザーの機能とインターフェイスの検出
keywords: hyper-v
author: alexgrest
ms.author: alegre
ms.date: 10/15/2020
ms.topic: reference
ms.prod: windows-10-hyperv
ms.openlocfilehash: b88cb0be23f4e3ea4ba1007d48bd11fe48749f00
ms.sourcegitcommit: d43632e3dc22e2b7a256b5c15fbb665c047de286
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/16/2020
ms.locfileid: "92120906"
---
# <a name="feature-and-interface-discovery"></a>機能とインターフェイスの検出

ゲストソフトウェアは、さまざまなメカニズムを使用してハイパーバイザーとやり取りします。 これらの多くは、基盤となるプロセッサとの対話にソフトウェアによって使用される従来のメカニズムをミラー化しています。 そのため、これらのメカニズムはアーキテクチャによって異なります。 X64 アーキテクチャでは、次のメカニズムが使用されます。

- CPUID 命令-静的な機能とバージョン情報に使用されます。
- MSRs (モデル固有のレジスタ) –状態と制御の値に使用されます。
- メモリマップトレジスタ–状態および制御値に使用されます。
- プロセッサ割り込み–非同期イベント、通知、メッセージに使用されます。

ハイパーバイザーは、これらのアーキテクチャ固有のインターフェイスに加えて、ハイパー [コール](hypercall-interface.md)で実装される簡単な手続き型インターフェイスを提供します。

## <a name="hypervisor-discovery"></a>ハイパーバイザー検出

ハイパーバイザーインターフェイスを使用する前に、まず、仮想化環境内で実行されているかどうかを確認する必要があります。 この仕様に準拠している x64 プラットフォームでは、入力 (EAX) 値が1である CPUID 命令を実行してこれを行います。 実行時には、コードで ECX ("ハイパーバイザー present ビット") のビット31を確認する必要があります。 このビットが設定されている場合は、ハイパーバイザーが存在します。 非仮想化環境では、ビットはクリアされます。

 ```c
CPUID.01h.ECX:31 // if set, virtualization present
 ```

"ハイパーバイザー present bit" が設定されている場合は、準拠しているハイパーバイザーとその機能の詳細について、追加の CPUID リーフを照会できます。 このようなリーフは、との2つが使用できることが保証され `0x40000000` てい `0x40000001` ます。 後から番号が付けられたリーフも使用できる可能性があります。

## <a name="standard-hypervisor-cpuid-leaves"></a>標準ハイパーバイザー CPUID リーフ

のリーフが照会されると `0x40000000` 、ハイパーバイザーは、最大ハイパーバイザーの CPUID リーフ番号とベンダー ID の署名を提供する情報を返します。

| [登録]  | 情報提供済み                                        |
|-----------|-------------------------------------------------------------|
| EAX       | ハイパーバイザーの CPUID 情報の最大入力値    |
| EBX       | ハイパーバイザーベンダー ID 署名                              |
| ECX       | ハイパーバイザーベンダー ID 署名                              |
| EDX       | ハイパーバイザーベンダー ID 署名                              |

のリーフに対し `0x40000001` てクエリを実行すると、ベンダー中立のハイパーバイザーインターフェイス id を表す値が返されます。 これにより、からのリーフのセマンティクスが決まり `0x4000002` `0x400000FF` ます。

| [登録]  | 情報提供済み                                        |
|-----------|-------------------------------------------------------------|
| EAX       | ハイパーバイザーインターフェイスの署名。                             |
| EBX       | 予約済み                                                    |
| ECX       | 予約済み                                                    |
| EDX       | 予約済み                                                    |

この2つのリーフによって、ゲストはハイパーバイザーのベンダー ID とインターフェイスを個別に照会できます。 ベンダー ID は、情報と診断の目的でのみ提供されています。 ソフトウェアは、リーフを通じて報告されたインターフェイスの署名に対してのみ、基本互換性の決定を行うことをお勧め `0x40000001` します。

## <a name="microsoft-hypervisor-cpuid-leaves"></a>Microsoft ハイパーバイザー CPUID リーフ

Microsoft ハイパーバイザー CPUID インターフェイスに準拠しているハイパーバイザーでは、 `0x40000000` との `0x40000001` リーフレジスタの値は次のようになります。

### <a name="hypervisor-cpuid-leaf-range---0x40000000"></a>ハイパーバイザーの CPUID リーフ範囲-0x40000000

EAX は、最大ハイパーバイザーの CPUID リーフを決定します。 EBX-EDX には、ハイパーバイザーベンダー ID の署名が含まれています。 ベンダ ID 署名は、レポートと診断の目的でのみ使用してください。

| [登録]  | 情報提供済み                                        |
|-----------|-------------------------------------------------------------|
| EAX       | ハイパーバイザーの CPUID 情報の最大入力値。 Microsoft ハイパーバイザーでは、これは少なくともになり `0x40000005` ます。  |
| EBX       | 0X72636、"Micr"                                           |
| ECX       | 0x666F736F — "osof"                                           |
| EDX       | 0x76482074 — "t Hv"                                           |

### <a name="hypervisor-vendor-neutral-interface-identification---0x40000001"></a>ハイパーバイザーベンダーに依存しないインターフェイスの識別-0x40000001

EAX には、ハイパーバイザーインターフェイス識別署名が含まれています。 これにより、からのリーフのセマンティクスが決まり `0x40000002` `0x400000FF` ます。

| [登録]  | 情報提供済み                                        |
|-----------|-------------------------------------------------------------|
| EAX       | 0x31237648-"Hv # 1"                                           |
| EBX       | 予約済み                                                    |
| ECX       | 予約済み                                                    |
| EDX       | 予約済み                                                    |

"Hv # 1" インターフェイスに準拠しているハイパーバイザーでは、少なくとも次のリーフが提供されます。

### <a name="hypervisor-system-identity---0x40000002"></a>ハイパーバイザーシステム Id-0x40000002

<!---
+-----------+-------+------------------------+
| Register  | Bits  | Information Provided   |
+===========+=======+========================+
| EAX       |       | Build Number           |
+-----------+-------+------------------------+
| EBX       | 31-16 | Major Version          |
+           +-------+------------------------+
|           | 15-0  | Minor Version          |
+-----------+-------+------------------------+
| ECX       |       | Service Pack           |
+-----------+-------+------------------------+
| EDX       | 31-24 | Service Branch         |
+           +-------+------------------------+
|           | 23-0  | Service Number         |
+-----------+-------+------------------------+
-->

<table>
    <thead>
        <tr>
            <th>[登録]</th>
            <th>Bits</th>
            <th>情報提供済み</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>EAX</td>
            <td></td>
            <td>ビルド番号</td>
        </tr>
        <tr>
            <td rowspan="2">EBX</td>
            <td>31-16</td>
            <td>メジャー バージョン</td>
        </tr>
         <tr>
            <td>15-0</td>
            <td>マイナー バージョン</td>
        </tr>
    </tbody>
</table>

### <a name="hypervisor-feature-identification---0x40000003"></a>ハイパーバイザー機能の識別-0x40000003

EAX と EBX は、現在のパーティションの特権に基づいて、パーティションで使用できる機能を示します。

<!---
+-----------+-------+---------------------------------------------------------------------------------------+
| Register  | Bits  | Information Provided                                                                  |
+===========+=======+=======================================================================================+
| EAX       |       | Corresponds to bits 31-0 of HV_PARTITION_PRIVILEGE_MASK                               |
+-----------+-------+---------------------------------------------------------------------------------------+
| EBX       |       | Corresponds to bits 63-32 of HV_PARTITION_PRIVILEGE_MASK                              |
+-----------+-------+---------------------------------------------------------------------------------------+
| ECX       |       |                                                                                       |
+-----------+-------+---------------------------------------------------------------------------------------+
| EDX       | 0     | Deprecated (previously indicated availability of the MWAIT command).                  |
+           +-------+---------------------------------------------------------------------------------------+
|           | 1     | Guest debugging support is available                                                  |
+           +-------+---------------------------------------------------------------------------------------+
|           | 2     | Performance Monitor support is available                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 3     | Support for physical CPU dynamic partitioning events is available                     |
+           +-------+---------------------------------------------------------------------------------------+
|           | 4     | Support for passing hypercall input parameter block via XMM registers is available    |
+           +-------+---------------------------------------------------------------------------------------+
|           | 5     | Support for a virtual guest idle state is available                                   |
+           +-------+---------------------------------------------------------------------------------------+
|           | 6     | Support for hypervisor sleep state is available                                       |
+           +-------+---------------------------------------------------------------------------------------+
|           | 7     | Support for querying NUMA distances is available                                      |
+           +-------+---------------------------------------------------------------------------------------+
|           | 8     | Support for determining timer frequencies is available                                |
+           +-------+---------------------------------------------------------------------------------------+
|           | 9     | Support for injecting synthetic machine checks is available                           |
+           +-------+---------------------------------------------------------------------------------------+
|           | 10    | Support for guest crash MSRs is available                                             |
+           +-------+---------------------------------------------------------------------------------------+
|           | 11    | Support for debug MSRs is available                                                   |
+           +-------+---------------------------------------------------------------------------------------+
|           | 12    | Support for NPIEP is available                                                        |
+           +-------+---------------------------------------------------------------------------------------+
|           | 13    | DisableHypervisorAvailable                                                            |
+           +-------+---------------------------------------------------------------------------------------+
|           | 14    | ExtendedGvaRangesForFlushVirtualAddressListAvailable                                  |
+           +-------+---------------------------------------------------------------------------------------+
|           | 15    | Support for returning hypercall output via XMM registers is available                 |
+           +-------+---------------------------------------------------------------------------------------+
|           | 16    | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 17    | SintPollingModeAvailable                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 18    | HypercallMsrLockAvailable                                                             |
+           +-------+---------------------------------------------------------------------------------------+
|           | 19    | Use direct synthetic timers                                                           |
+           +-------+---------------------------------------------------------------------------------------+
|           | 31-20 | Reserved                                                                              |
-->

<table>
    <thead>
        <tr>
            <th>[登録]</th>
            <th>Bits</th>
            <th>情報提供済み</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>EAX</td>
            <td></td>
            <td>HV_PARTITION_PRIVILEGE_MASK のビット31-0 に対応します。</td>
        </tr>
        <tr>
            <td>EBX</td>
            <td></td>
            <td>HV_PARTITION_PRIVILEGE_MASK のビット63-32 に対応します。</td>
        </tr>
        <tr>
            <td>ECX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td rowspan="27">EDX</td>
            <td>0</td>
            <td>非推奨 (以前は MWAIT 命令の可用性が示されました)</td>
        </tr>
        <tr>
            <td>1</td>
            <td>ゲストデバッグのサポートを利用できます</td>
        </tr>
        <tr>
            <td>2</td>
            <td>パフォーマンスモニターのサポートを利用できます</td>
        </tr>
        <tr>
            <td>3</td>
            <td>物理 CPU 動的パーティション分割イベントのサポートを利用できます</td>
        </tr>
        <tr>
            <td>4</td>
            <td>XMM レジスタを使用してハイパーコール入力パラメーターブロックを渡すことができます</td>
        </tr>
        <tr>
            <td>5</td>
            <td>仮想ゲストのアイドル状態のサポートを利用できます</td>
        </tr>
        <tr>
            <td>6</td>
            <td>ハイパーバイザースリープ状態のサポートを利用できます</td>
        </tr>
        <tr>
            <td>7</td>
            <td>NUMA 距離のクエリのサポートを利用できます</td>
        </tr>
        <tr>
            <td>8</td>
            <td>タイマーの頻度を決定するためのサポートを利用できます</td>
        </tr>
        <tr>
            <td>9</td>
            <td>統合マシンのチェックを挿入するためのサポートが利用可能です</td>
        </tr>
        <tr>
            <td>10</td>
            <td>ゲストクラッシュ MSRs のサポートを利用できます</td>
        </tr>
        <tr>
            <td>11</td>
            <td>Debug MSRs のサポートを利用できます</td>
        </tr>
        <tr>
            <td>12</td>
            <td>NPIEP のサポートを利用できます</td>
        </tr>
        <tr>
            <td>13</td>
            <td>DisableHypervisorAvailable</td>
        </tr>
        <tr>
            <td>14</td>
            <td>ExtendedGvaRangesForFlushVirtualAddressListAvailable</td>
        </tr>
        <tr>
            <td>15</td>
            <td>XMM レジスタ経由でハイパーコール出力を返すためのサポートを利用できます</td>
        </tr>
        <tr>
            <td>16</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>17</td>
            <td>SintPollingModeAvailable</td>
        </tr>
        <tr>
            <td>18</td>
            <td>HypercallMsrLockAvailable</td>
        </tr>
        <tr>
            <td>19</td>
            <td>ダイレクト代理タイマーを使用する</td>
        </tr>
        <tr>
            <td>20</td>
            <td>VSM で利用可能な PAT 登録のサポート</td>
        </tr>
        <tr>
            <td>21</td>
            <td>VSM で使用可能な bndcfgs 登録のサポート</td>
        </tr>
        <tr>
            <td>22</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>23</td>
            <td>統合時間の停止タイマーのサポートを利用可能</td>
        </tr>
        <tr>
            <td>25-24</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>26</td>
            <td>Intel の最終ブランチレコード (LBR) 機能がサポートされています</td>
        </tr>
        <tr>
            <td>31-27</td>
            <td>予約済み</td>
        </tr>
    </tbody>
</table>

### <a name="implementation-recommendations---0x40000004"></a>実装に関する推奨事項-0x40000004

最適なパフォーマンスを得るために、ハイパーバイザーが OS 実装を推奨する動作を示します。

<!---
+-----------+-------+---------------------------------------------------------------------------------------+
| Register  | Bits  | Information Provided                                                                  |
+===========+=======+=======================================================================================+
| EAX       | 0     | Recommend using hypercall for address space switches rather than MOV to CR3 instruction
+           +-------+---------------------------------------------------------------------------------------+
|           | 1     | Recommend using hypercall for local TLB flushes rather than INVLPG or MOV to CR3 instructions
+           +-------+---------------------------------------------------------------------------------------+
|           | 2     | Recommend using hypercall for remote TLB flushes rather than inter-processor interrupts
+           +-------+---------------------------------------------------------------------------------------+
|           | 3     | Recommend using MSRs for accessing APIC registers EOI, ICR and TPR rather than their memory-mapped counterparts
+           +-------+---------------------------------------------------------------------------------------+
|           | 4     | Recommend using the hypervisor-provided MSR to initiate a system RESET                |
+           +-------+---------------------------------------------------------------------------------------+
|           | 5     | Recommend using relaxed timing for this partition. If used, the VM should disable any watchdog timeouts that rely on the timely delivery of external interrupts.
+           +-------+---------------------------------------------------------------------------------------+
|           | 6     | Recommend using DMA remapping                                                         |
+           +-------+---------------------------------------------------------------------------------------+
|           | 7     | Recommend using interrupt remapping                                                   |
+           +-------+---------------------------------------------------------------------------------------+
|           | 8     | Recommend using x2APIC MSRs                                                           |
+           +-------+---------------------------------------------------------------------------------------+
|           | 9     | Recommend deprecating AutoEOI                                                         |
+           +-------+---------------------------------------------------------------------------------------+
|           | 10    | Recommend using SyntheticClusterIpi hypercall                                         |
+           +-------+---------------------------------------------------------------------------------------+
|           | 11    | Recommend using the newer ExProcessorMasks interface                                  |
+           +-------+---------------------------------------------------------------------------------------+
|           | 12    |  Indicates that the hypervisor is nested within a Hyper-V partition.                  |
+           +-------+---------------------------------------------------------------------------------------+
|           | 13    | Recommend using INT for MBEC system calls                                             |
+           +-------+---------------------------------------------------------------------------------------+
|           | 14    | Recommend a nested hypervisor using the enlightened VMCS interface. Also indicates that additional nested enlightenments may be available (see leaf `0x4000000A`)
+           +-------+---------------------------------------------------------------------------------------+
|           | 15    | UseSyncedTimeline – Indicates the partition should consume the QueryPerformanceCounter bias provided by the root partition.
+           +-------+---------------------------------------------------------------------------------------+
|           | 16    | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 17    | UseDirectLocalFlushEntire – Indicates the guest should toggle CR4.PGE to flush the entire TLB, as this is more performant than making a hypercall.
+           +-------+---------------------------------------------------------------------------------------+
|           | 18    | NoNonArchitecturalCoreSharing - Indicates that a virtual processor will never share a physical core with another virtual processor, except for virtual processors that are reported as sibling SMT threads. This can be used as an optimization to avoid the performance overhead of STIBP.
+           +-------+---------------------------------------------------------------------------------------+
|           | 31-19 | Reserved                                                                              |
+-----------+-------+---------------------------------------------------------------------------------------+
| EBX       |       | Recommended number of attempts to retry a spinlock failure before notifying the hypervisor about the failures. 0xFFFFFFFF indicates never to retry.
+-----------+-------+---------------------------------------------------------------------------------------+
| ECX       | 6-0   | ImplementedPhysicalAddressBits – Reports the physical address width (MAXPHYADDR) reported by the system’s physical processors. If all bits contain 0, the feature is not supported. Note that the value reported is the actual number of physical address bits, and not the bit position used to represent that number.
+           +-------+---------------------------------------------------------------------------------------+
|           | 31-7  | Reserved                                                                              |
+-----------+-------+---------------------------------------------------------------------------------------+
| EDX       |       |   Reserved                                                                            |
-->

<table>
    <thead>
        <tr>
            <th>[登録]</th>
            <th>Bits</th>
            <th>情報提供済み</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan="20">EAX</td>
            <td>0</td>
            <td>ハイパーコールを CR3 命令ではなくアドレス空間スイッチに使用することをお勧めします。</td>
        </tr>
        <tr>
            <td>1</td>
            <td>INVLPG や MOV ではなく、ローカルの TLB フラッシュにハイパーコールを使用することをお勧めします。</td>
        </tr>
        <tr>
            <td>2</td>
            <td>プロセッサ間の割り込みではなく、リモートの TLB フラッシュにハイパーコールを使用することをお勧めします。</td>
        </tr>
        <tr>
            <td>3</td>
            <td>APIC レジスタ EOI、ICR、および TPR にアクセスするために MSRs を使用することをお勧めします。これは、対応するメモリマップトレジスタではありません。</td>
        </tr>
        <tr>
            <td>4</td>
            <td>ハイパーバイザーによって提供される MSR を使用してシステムのリセットを開始することをお勧めします。</td>
        </tr>
        <tr>
            <td>5</td>
            <td>このパーティションには、緩やかなタイミングを使用することをお勧めします。 使用する場合、VM は、外部割り込みの適時の配信に依存するウォッチドッグタイムアウトをすべて無効にする必要があります。</td>
        </tr>
        <tr>
            <td>6</td>
            <td>DMA の再マップを使用することをお勧めします。</td>
        </tr>
        <tr>
            <td>7</td>
            <td>割り込み再マップを使用することをお勧めします。</td>
        </tr>
        <tr>
            <td>8</td>
            <td>予約済み。</td>
        </tr>
        <tr>
            <td>9</td>
            <td>非推奨 AutoEOI を推奨します。</td>
        </tr>
        <tr>
            <td>10</td>
            <td>Syntheハイパーコール Clusteripi を使用することをお勧めします。</td>
        </tr>
        <tr>
            <td>11</td>
            <td>新しい ExProcessorMasks インターフェイスを使用することをお勧めします。</td>
        </tr>
        <tr>
            <td>12</td>
            <td>ハイパーバイザーが Hyper-v パーティション内で入れ子になっていることを示します。</td>
        </tr>
        <tr>
            <td>13</td>
            <td>MBEC システムの呼び出しには INT を使用することをお勧めします。</td>
        </tr>
        <tr>
            <td>14</td>
            <td>対応 VMCS インターフェイスを使用して入れ子になったハイパーバイザーを推奨します。 また、入れ子になった追加の enlightenments も使用できることを示します (リーフ0x4000000A を参照してください)。</td>
        </tr>
        <tr>
            <td>15</td>
            <td>UseSyncedTimeline –パーティションがルートパーティションによって提供される QueryPerformanceCounter バイアスを使用する必要があることを示します。</td>
        </tr>
        <tr>
            <td>16</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>17</td>
            <td>UseDirectLocalFlushEntire –ゲストが CR4 を切り替える必要があることを示します。PGE は、ハイパーコールを作成するよりもパフォーマンスが高いため、TLB 全体をフラッシュします。</td>
        </tr>
        <tr>
            <td>18</td>
            <td>NoNonArchitecturalCoreSharing-コア共有が不可能であることを示します。 これを最適化として使用すると、同一のパフォーマンスオーバーヘッドを回避できます。</td>
        </tr>
       <tr>
            <td>31-19</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>EBX</td>
            <td></td>
            <td>障害についてハイパーバイザーに通知する前にスピンロックエラーを再試行するための推奨回数。 0xFFFFFFFF は通知しないことを示します。</td>
        </tr>
        <tr>
            <td rowspan="2">ECX</td>
            <td>6-0</td>
            <td>ImplementedPhysicalAddressBits –システムの物理プロセッサによって報告された物理アドレスの幅 (MAXPHYADDR) を報告します。 すべてのビットに0が含まれている場合、この機能はサポートされません。 報告される値は、物理アドレスビットの実際の数であり、その数値を表すために使用されるビット位置ではないことに注意してください。</td>
        </tr>
        <tr>
            <td>31-7</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>EDX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
    </tbody>
</table>

### <a name="hypervisor-implementation-limits---0x40000005"></a>ハイパーバイザー実装制限-0x40000005

現在のハイパーバイザー実装でサポートされているスケール制限について説明します。 いずれかの値が0の場合、ハイパーバイザーは対応する情報を公開しません。それ以外の場合は、これらの意味があります。

| [登録]  | 情報提供済み                                                                 |
|-----------|--------------------------------------------------------------------------------------|
| EAX       | サポートされる仮想プロセッサの最大数                                   |
| EBX       | サポートされる論理プロセッサの最大数                                   |
| ECX       | 割り込み再マップに使用できる物理割り込みベクターの最大数。  |
| EDX       | 予約済み                                                                             |

### <a name="implementation-hardware-features---0x40000006"></a>実装ハードウェア機能-0x40000006

ハードウェア固有の機能が検出され、現在ハイパーバイザーによって使用されていることを示します。

<!---
+-----------+-------+---------------------------------------------------------------------------------------+
| Register  | Bits  | Information Provided                                                                  |
+===========+=======+=======================================================================================+
| EAX       | 0     | Support for APIC overlay assist is detected and in use                                |
+           +-------+---------------------------------------------------------------------------------------+
|           | 1     | Support for MSR bitmaps is detected and in use                                        |
+           +-------+---------------------------------------------------------------------------------------+
|           | 2     | Support for architectural performance counters is detected and in use                 |
+           +-------+---------------------------------------------------------------------------------------+
|           | 3     | Support for second level address translation is detected and in use                   |
+           +-------+---------------------------------------------------------------------------------------+
|           | 4     | Support for DMA remapping is detected and in use                                      |
+           +-------+---------------------------------------------------------------------------------------+
|           | 5     | Support for interrupt remapping is detected and in use                                |
+           +-------+---------------------------------------------------------------------------------------+
|           | 6     | Indicates that a memory patrol scrubber is present in the hardware                    |
+           +-------+---------------------------------------------------------------------------------------+
|           | 7     | DMA protection is in use                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 8     | HPET is requested                                                                     |
+           +-------+---------------------------------------------------------------------------------------+
|           | 9     | Synthetic timers are volatile                                                         |
+           +-------+---------------------------------------------------------------------------------------+
|           | 31-10 | Reserved                                                                              |
+-----------+-------+---------------------------------------------------------------------------------------+
| EBX       | Reserved                                                                                      |
+-----------+-----------------------------------------------------------------------------------------------+
| ECX       | Reserved                                                                                      |
+-----------+-----------------------------------------------------------------------------------------------+
| EDX       | Reserved                                                                                      |
-->

<table>
    <thead>
        <tr>
            <th>[登録]</th>
            <th>Bits</th>
            <th>情報提供済み</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan="11">EAX</td>
            <td>0</td>
            <td>APIC オーバーレイアシスタンスのサポートが検出され、使用されています。</td>
        </tr>
        <tr>
            <td>1</td>
            <td>MSR ビットマップのサポートが検出され、使用されています。</td>
        </tr>
        <tr>
            <td>2</td>
            <td>アーキテクチャパフォーマンスカウンターのサポートが検出され、使用されます。</td>
        </tr>
        <tr>
            <td>3</td>
            <td>第2レベルのアドレス変換のサポートが検出され、使用されています。</td>
        </tr>
        <tr>
            <td>4</td>
            <td>DMA の再マップのサポートが検出され、使用されています。</td>
        </tr>
        <tr>
            <td>5</td>
            <td>割り込み再マップのサポートが検出され、使用されています。</td>
        </tr>
        <tr>
            <td>6</td>
            <td>ハードウェアにメモリパトロール削除機能があることを示します。</td>
        </tr>
        <tr>
            <td>7</td>
            <td>DMA 保護が使用されています。</td>
        </tr>
        <tr>
            <td>8</td>
            <td>HPET が要求されます。</td>
        </tr>
        <tr>
            <td>9</td>
            <td>合成タイマーは揮発性です。</td>
        </tr>
        <tr>
            <td>31-10</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>EBX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>ECX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>EDX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
    </tbody>
</table>

### <a name="nested-hypervisor-feature-identification---0x40000009"></a>入れ子になったハイパーバイザー機能の識別-0x40000009

入れ子になっているの実行時に、ハイパーバイザーによってパーティションに公開される機能について説明します。 EAX は、仮想 MSRs へのアクセスを記述します。 EDX は、ハイパーコールへのアクセスについて説明します。

<!---
+-----------+-------+---------------------------------------------------------------------------------------+
| Register  | Bits  | Information Provided                                                                  |
+===========+=======+=======================================================================================+
| EAX       | 1-0   | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 2     | AccessSynicRegs                                                                       |
+           +-------+---------------------------------------------------------------------------------------+
|           | 3     | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 4     | AccessIntrCtrlRegs                                                                    |
+           +-------+---------------------------------------------------------------------------------------+
|           | 5     | AccessHypercallMsrs                                                                   |
+           +-------+---------------------------------------------------------------------------------------+
|           | 6     | AccessVpIndex                                                                         |
+           +-------+---------------------------------------------------------------------------------------+
|           | 11-7  | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 12    | AccessReenlightenmentControls                                                         |
+           +-------+---------------------------------------------------------------------------------------+
|           | 31-13 | Reserved                                                                              |
+-----------+-------+---------------------------------------------------------------------------------------+
| EBX       | Reserved                                                                                      |
+-----------+-----------------------------------------------------------------------------------------------+
| ECX       | Reserved                                                                                      |
+-----------+-----------------------------------------------------------------------------------------------+
| EDX       | 3-0   | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 4     | XmmRegistersForFastHypercallAvailable                                                 |
+           +-------+---------------------------------------------------------------------------------------+
|           | 14-5  | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 15    | FastHypercallOutputAvailable                                                          |
+           +-------+---------------------------------------------------------------------------------------+
|           | 16    | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 17    | SintPollingModeAvailable                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 31-18 | Reserved                                                                              |
-->

<table>
    <thead>
        <tr>
            <th>[登録]</th>
            <th>Bits</th>
            <th>情報提供済み</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan="9">EAX</td>
            <td>1-0</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>2</td>
            <td>AccessSynicRegs</td>
        </tr>
        <tr>
            <td>3</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>4</td>
            <td>AccessIntrCtrlRegs</td>
        </tr>
        <tr>
            <td>5</td>
            <td>AccessHypercallMsrs</td>
        </tr>
        <tr>
            <td>6</td>
            <td>AccessVpIndex</td>
        </tr>
        <tr>
            <td>11-7</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>12</td>
            <td>AccessReenlightenmentControls</td>
        </tr>
        <tr>
            <td>31-13</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>EBX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>ECX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td rowspan="7">EDX</td>
            <td>3-0</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>4</td>
            <td>XmmRegistersForFastHypercallAvailable</td>
        </tr>
        <tr>
            <td>14-5</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>15</td>
            <td>FastHypercallOutputAvailable</td>
        </tr>
        <tr>
            <td>16</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>17</td>
            <td>SintPollingModeAvailable</td>
        </tr>
        <tr>
            <td>31-18</td>
            <td>予約済み</td>
        </tr>
    </tbody>
</table>

### <a name="hypervisor-nested-virtualization-features---0x4000000a"></a>ハイパーバイザーの入れ子になった仮想化機能-0x4000000A

入れ子になったハイパーバイザーで使用できる入れ子になった仮想化の最適化を示します。

<!---
+-----------+-------+---------------------------------------------------------------------------------------+
| Register  | Bits  | Information Provided                                                                  |
+===========+=======+=======================================================================================+
| EAX       | 7-0   | Enlightened VMCS version (low)                                                        |
+           +-------+---------------------------------------------------------------------------------------+
|           | 15-8  | Enlightened VMCS version (high)                                                       |
+           +-------+---------------------------------------------------------------------------------------+
|           | 16    | Reserved                                                                              |
+           +-------+---------------------------------------------------------------------------------------+
|           | 17    | Indicates support for direct virtual flush hypercalls                                 |
+           +-------+---------------------------------------------------------------------------------------+
|           | 18    | Indicates support for the HvFlushGuestPhysicalAddressSpace and HvFlushGuestPhysicalAddressList hypercalls
+           +-------+---------------------------------------------------------------------------------------+
|           | 19    | Indicates support for using an enlightened MSR bitmap.                                |
+           +-------+---------------------------------------------------------------------------------------+
|           | 31-20 | Reserved                                                                              |
+-----------+-------+---------------------------------------------------------------------------------------+
| EBX       | Reserved                                                                                      |
+-----------+-----------------------------------------------------------------------------------------------+
| ECX       | Reserved                                                                                      |
+-----------+-----------------------------------------------------------------------------------------------+
| EDX       | Reserved                                                                                      |
-->

<table>
    <thead>
        <tr>
            <th>[登録]</th>
            <th>Bits</th>
            <th>情報提供済み</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td rowspan="8">EAX</td>
            <td>7-0</td>
            <td>対応 VMCS バージョン (低)</td>
        </tr>
        <tr>
            <td>15-8</td>
            <td>対応 VMCS バージョン (high)</td>
        </tr>
        <tr>
            <td>16</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>17</td>
            <td>直接仮想フラッシュハイパーコールのサポートを示します。</td>
        </tr>
        <tr>
            <td>18</td>
            <td>HvFlushGuestPhysicalAddressSpace および HvFlushGuestPhysicalAddressList ハイパーコールのサポートを示します。</td>
        </tr>
        <tr>
            <td>19</td>
            <td>対応 MSR ビットマップの使用をサポートしていることを示します。</td>
        </tr>
        <tr>
            <td>20</td>
            <td>ページフォールト例外クラスでの仮想化例外の結合をサポートしていることを示します。</td>
        </tr>
        <tr>
            <td>31-21</td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>EBX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>ECX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
        <tr>
            <td>EDX</td>
            <td></td>
            <td>予約済み</td>
        </tr>
    </tbody>
</table>

## <a name="versioning"></a>バージョン管理

ハイパーバイザーのバージョン情報は、リーフでエンコードされ `0x40000002` ます。 メインバージョンとサービスバージョンの2つのバージョン番号が提供されています。

メインバージョンには、メジャーバージョン番号とマイナーバージョン番号、ビルド番号が含まれています。 これらは、Microsoft Windows のリリース番号に対応しています。 サービスバージョンでは、メインバージョンに加えられた変更が記述されています。

クライアントは、バージョン範囲と比較するのではなく、CPUID リーフを使用してハイパーバイザー機能を確認することを強くお勧め `0x40000003` `0x40000005` します。